- name: Restart Business Interaction Replication Task
  include_tasks: restart_business_interaction_task.yml

# We do not need to wait for the Audited Interaction Checksum Replication to start as the main
# Audited Interaction data replication is not dependent on it
- name: Restart the Audited Interaction Checksum DMS CDC Replication Tasks from Requested Time
  shell: |
         aws dms start-replication-task --replication-task-arn "{{ audited_interaction_checksum_task_arn }}" \
            --cdc-start-position "{{ audit_cdc_scn }}" \
            --start-replication-task-type start-replication

# We supply user_cdc_start_time as the lower bound for user_ and
# probation_area_user replication data
# (we do not replicate any records earlier than this time).  This is used
# to ensure we only replicate user data which is newer than that already
# present in the database as a consequence of a restore, duplicate or flashback.
- name: Restart the User and Probation Area DMS CDC Replication Tasks from Requested Time
  shell: |
         aws dms start-replication-task --replication-task-arn "{{ user__task_arn }}" \
            --cdc-start-time "{{ user_cdc_start_time }}" \
            --start-replication-task-type start-replication

# We supply audit_cdc_scn as the lower bound for audit replication
# (we do not replicate any audit records earlier than this time).  This is used
# to ensure we only replicate audit created after the database has been opened
# to users and not old audit records which were already present as a result of
# a restore, duplicate or flashback.
- name: Restart the Audited Interaction DMS CDC Replication Tasks from Requested Time
  shell: |
         aws dms start-replication-task --replication-task-arn "{{ audited_interaction_task_arn }}" \
            --cdc-start-position "{{ audit_cdc_scn }}" \
            --start-replication-task-type start-replication