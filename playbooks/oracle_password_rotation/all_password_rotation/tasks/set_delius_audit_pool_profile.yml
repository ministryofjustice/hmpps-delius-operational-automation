# The DELIUS_AUDIT_POOL User Uses the Same Profile as DBSNMP 
# as we want it to have access to Gradual Database Password Rollover
# to avoid audit preservation failures during password changes since
# there will be a slight delay betwen changing the password in the
# database and updating the Audit Wallet on the OEM Server.

# Check Which Profile DELIUS_AUDIT_POOL is Using
- name: Check Current DELIUS_AUDIT_POOL Profile
  script: get_current_profile.sh
  register: get_delius_audit_pool_current_profile
  changed_when: false
  environment:
      DB_NAME: "{{ db_name }}"
      LOGIN_USER: "{{ login_user }}"
      LOGIN_PWD: "{{ login_pwd }}"
      PROFILE_USER: "DELIUS_AUDIT_POOL"

- name: Set DELIUS_AUDIT_POOL Profile
  script: set_monitoring_profile.sh
  when: get_delius_audit_pool_current_profile.stdout_lines[-1] != 'DBSNMP_MONITORING_PROFILE'
  environment:
      DB_NAME: "{{ db_name }}"
      LOGIN_USER: "{{ login_user }}"
      LOGIN_PWD: "{{ login_pwd }}"
      PROFILE_USER: "DELIUS_AUDIT_POOL"
      PROFILE_NAME: "DBSNMP_MONITORING_PROFILE"