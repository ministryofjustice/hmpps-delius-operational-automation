- name: Initialise Secrets Dictionary And Variables
  set_fact:
    secretsmanager_passwords_dict: {}

- name: Setup Temporary Secrets Dictionary
  set_fact:
    secret_password_dict:
      account:
        secret: "{{ secret_name }}"

- name: Add User {{ db_username }} To Secret Dictionary
  set_fact:
    secret_password_dict: "{{ secret_password_dict |  combine({ 'account': { 'users': [{db_username: new_password | default(None) }] }}, recursive=true) }}"
     
- name: Update {{ db_username }} Password In Secrets
  include_role:
    name: secretsmanager-passwords
  vars:
    secretsmanager_passwords: "{{ secret_password_dict }}"
