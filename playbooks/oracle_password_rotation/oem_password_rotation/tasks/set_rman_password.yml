- name: Set RMAN Password In Secrets
  block:

    - name: Add Password To RMAN secret dictionary
      set_fact:
        rman_secretsmanager_passwords: "{{ rman_secretsmanager_passwords |  combine({ 'catalog': { 'users': [{'rman': new_password}] }}, recursive=true) }}"

    - name: Update RMAN Password In Secrets
      import_role:
        name: secretsmanager-passwords
      vars:
        secretsmanager_passwords: "{{ rman_secretsmanager_passwords }}"
      when: rman_password != existing_rman_password