# - name: Set Secret Id
#   set_fact:
#     secret_oem_id: "{{ oem_secretsmanager_passwords['oem']['secret'] }}"

# - name: Set Variable For SYSMAN Password
#   set_fact:
#     sysman_password: "{{ lookup('amazon.aws.aws_secret', '{{ secret_oem_id }}', region='eu-west-2') | from_json | json_query('sysman') }}"

- name: Get OEM secrets
  import_role:
    name: secretsmanager-passwords
  vars:
    secretsmanager_passwords: "{{ oem_secretsmanager_passwords }}"

- name: Set Variable For SYSMAN Password
  set_fact:
    sysman_password: "{{ secretsmanager_passwords_dict['oem'].passwords['sysman'] }}"

- name: Update the OEM Targets to Match the Secrets
  include_tasks: set_monitoring_passwords.yml
