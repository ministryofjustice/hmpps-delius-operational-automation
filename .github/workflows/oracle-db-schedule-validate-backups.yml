name: "Oracle: Schedule Validate Backups"
on:
  push:
    branches:
       - "DBA-662"
  schedule:
    - cron: '30 10 * * 1'
    - cron: '30 10 * * 2'
    - cron: '30 10 * * 3'
jobs:
  check_if_scheduled:
    runs-on: ubuntu-latest
    outputs:
        RunNow: ${{ steps.schedule-run.outputs.RunNow }}
    strategy:
        matrix:
          include:
            - TargetEnvironment: delius-core-dev
            - TargetHost: delius_primarydb
            - CronSchedule: '30 10 * * 2'
    steps:
      - name: Schedule Run
        id: schedule-run
        run: |
          [ "${{ github.event.schedule }}" == ${{ matrix.CronSchedule }} ] && echo "RunNow=true" || "RunNow=false" >> $GITHUB_OUTPUT
  run-workflow-call:
    env:
      RunNow: ${{ needs.check_if_scheduled.outputs.RunNow }}
    if: ${{ env.RunNow }} == 'true'
    uses:
      ministryofjustice/hmpps-delius-operational-automation/.github/workflows/oracle-db-backup.yml@main
    with:
      TargetEnvironment: ${{ matrix.TargetEnvironment }}
      TargetHost: ${{ matrix.TargetHost }}