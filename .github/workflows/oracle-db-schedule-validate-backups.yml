name: "Oracle: Schedule Validate Backups"
on:
  push:
    branches:
       - "DBA-662"
  schedule:
    - cron: '30 10 * * 1'
    - cron: '20 11 * * TUE'
    - cron: '30 10 * * 3'
jobs:
  check_if_scheduled:
    runs-on: ubuntu-latest
    strategy:
        matrix:
          include:
            - TargetEnvironment: delius-core-dev
              TargetHost: delius_primarydb
              CronSchedule: '20 11 * * TUE'
            - TargetEnvironment: delius-core-dev
              TargetHost: delius_standbydb1
              CronSchedule: '20 11 * * TUE'
            - TargetEnvironment: delius-core-test
              TargetHost: delius_primarydb
              CronSchedule: '20 11 * * TUE'
    steps:
      - name: Check Run Schedule
        id: check-run-schedule
        run: |
         # [ "${{ github.event.schedule }}" == "${{ matrix.CronSchedule }}" ] && echo "RunNow=true" || echo "RunNow=false" >> $GITHUB_OUTPUT
         echo "RunNow=true" >> $GITHUB_OUTPUT

      - name: Run Validation
        id: run-validation
        if: steps.check-run-schedule.RunNow == 'true'
        uses:
          ministryofjustice/hmpps-delius-operational-automation/.github/workflows/oracle-db-validate-backups.yml@DBA-662
        with:
          TargetEnvironment: ${{ matrix.TargetEnvironment }}
          TargetHost: ${{ matrix.TargetHost }}