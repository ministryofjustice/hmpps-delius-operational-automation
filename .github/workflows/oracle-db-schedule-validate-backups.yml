name: "Oracle: Schedule Validate Backups"
on:
  push:
    branches:
       - "DBA-662"
  schedule:
    - cron: '30 10 * * WED'
    - cron: '20 11 * * WED'
    - cron: '30 12 * * WED'
jobs:
  prepare-run-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - name: Checkout Validate Backups Schedule
        uses: actions/checkout@v4
        with:
          sparse-checkout-cone-mode: false
          sparse-checkout: |
             .github/workflows/oracle-db-validate-backups-schedule.json
          path: operations
          ref: "DBA-662"
          #ref: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.SourceCodeVersion || 'main' }}
          fetch-depth: 0

      - name: Report Backup Schedule
        id: report-backup-schedule
        run: |
             # cat operations/.github/workflows/oracle-db-validate-backups-schedule.json
             SCHEDULED_JSON=$(jq '[.[] | select (.CronSchedule!="${{ github.event.schedule }}") | {"TargetEnvironment","TargetHost"}]' operations/.github/workflows/oracle-db-validate-backups-schedule.json | jq '{include: .}')
             echo ${SCHEDULED_JSON}
