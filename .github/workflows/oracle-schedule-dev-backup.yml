name: "Oracle: Scheduled Delius Development Database Backup"
on:
  schedule:
    - cron: '30 09 * * 1,2,4,5'
    - cron: '30 06 * * 1'
  push:
    branches:
      - DBA-511
    paths:
      - .github/workflows/oracle-schedule-dev-backup.yml
jobs:
  prepare-workflow-call:
    runs-on: ubuntu-latest
    outputs:
      parameters_matrix: ${{ steps.parseparameters.outputs.parameters_matrix }}
    steps:
      - name: Parse parameters
        id: parseparameters
        run: |
          echo -n "parameters_matrix={\"include\":[" >> $GITHUB_OUTPUT
          echo -n '{"TargetAccount":"delius_core_development_dev","TargetHost":"delius_primarydb","Period":"daily"}' >> $GITHUB_OUTPUT
          echo "]}" >> $GITHUB_OUTPUT
  run-workflow-call:
    needs: prepare-workflow-call
    strategy:
      matrix: ${{ fromJson(needs.prepare-workflow-call.outputs.parameters_matrix) }}
      fail-fast: true
    runs-on: ubuntu-latest
    uses: 
      ministryofjustice/hmpps-delius-operational-automation/.github/workflows/oracle-backup.yml@main
    with:
      TargetAccount: ${{ matrix.TargetAccount }}
      TargetHost: ${{ matrix.TargetHost }}
      Period: ${{ matrix.Period }}
    secrets: inherit
